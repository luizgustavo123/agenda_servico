<!DOCTYPE html>

<html lang="pt-BR">
<head>

    <style>

        .box {
            width: 100%;
            height: 80px;
            position: fixed;
            z-index: 1000;
            bottom: 0;
            left: 0;
            background-color: #0D47A1;
        }

        .fieldset-border {
            border: 2px groove #ddd !important;
            border-radius: 20px;
            padding: 0 1.4em 1.4em 1.4em !important;
            margin: 0 0 1.5em 0 !important;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
            box-shadow: 0px 0px 0px 0px #000;
        }

            .fieldset-border .legend-border {
                font-size: 1.2em !important;
                text-align: left !important;
                width: auto;
                padding: 0 10px;
                border-bottom: none;
            }
        #comp_img_logo {
            border-radius: 50%;
            border: 1px solid #000;
        }
    </style>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <title>Agende aqui</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
</head>

<body>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.js"></script>
    <script src="https://unpkg.com/axios@1.0.0/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/v-mask/dist/v-mask.min.js"></script>


    <div id="app">
        <v-app id="inspire">

            <div>
                <v-toolbar elevation="1" color="#B3E5FC" height="150px">
                    <v-spacer></v-spacer>

                    <v-toolbar-title>
                        <template v-if="src_logo != '' && src_logo != 'https://i.ibb.co/n1g2HRY/addimagem.jpg'">
                            <v-img id="comp_img_logo" class="img-fluid" width="120" height="120"
                                   :src="`${src_logo}`"></v-img>
                        </template>
                        <template v-else>
                            <h1>{{nome_empresa}}</h1>
                        </template>
                    </v-toolbar-title>

                    <v-spacer></v-spacer>


                </v-toolbar>

                <v-bottom-navigation height="40" v-model="value">

                    <v-btn @click.stop="drawer = !drawer">
                        <v-icon>mdi-magnify</v-icon>
                    </v-btn>

                    <v-btn @click="abrir_dialog()">
                        <v-badge v-model="carrinho"
                                 color="error"
                                 :content="qtd_carrinho">
                            <v-icon>mdi-account</v-icon>
                        </v-badge>
                    </v-btn>

                </v-bottom-navigation>
            </div>

            <v-navigation-drawer v-model="drawer"
                                 absolute
                                 temporary>
                <v-system-bar color="blue lighten-5" height="40">
                    <h4>Pesquisar serviço</h4>
                    <v-spacer></v-spacer>
                    <v-btn icon
                           color="red"
                           x-large
                           @click.stop="drawer = !drawer">
                        <v-icon right>mdi-close</v-icon>
                    </v-btn>
                </v-system-bar>
                <v-row dense justify="center">
                    <v-col cols="10">
                        <br>
                        <v-text-field outlined
                                      dense
                                      autofocus
                                      v-model="prod_descricao"
                                      @click="limit_prod()"
                                      label="Pesquisar"
                                      @click:append="pesq_prod()"
                                      append-icon="mdi-magnify">
                        </v-text-field>

                    </v-col>
                </v-row>
            </v-navigation-drawer>

            <v-row>
                <v-col cols="12"
                       sm="12">
                    <v-sheet class="d-flex justify-center mb-6">
                        <v-slide-group v-model="model_categoria"
                                       show-arrows=false
                                       @change="select_categoria()">
                            <v-slide-item v-for="(item, n) in items_categoria"
                                          :key="n"
                                          v-slot="{ active, toggle }">
                                <div>
                                    <v-card :color="active ? undefined : 'grey lighten-1'"
                                            class="ma-4"
                                            height="80"
                                            width="80"
                                            :img="`${item.imagem}`"
                                            rounded="circle"
                                            @click="toggle">
                                    </v-card>

                                    <h6 class="text-center">{{`${item.nome_categoria}`}}</h6>
                                    <br><br><br>

                                </div>



                            </v-slide-item>

                        </v-slide-group>
                    </v-sheet>
                </v-col>
            </v-row>

            <v-container align="center">
                <v-row>
                    <v-col cols="12"
                           sm="12">
                        <h2>{{titulo_categoria}}</h2>
                    </v-col>
                </v-row>
            </v-container>

            <v-dialog persistent width="200" v-model="carregando">
                <v-card color="primary"
                        dark>
                    <v-card-text>
                        Carregando... Aguarde !
                        <v-progress-linear indeterminate
                                           color="white"
                                           class="mb-0">
                        </v-progress-linear>
                    </v-card-text>
                </v-card>
            </v-dialog>

            <v-item-group multiple v-model="model">
                <v-container>
                    <v-row>
                        <v-col v-for="(item, i) in items"
                               :key="i"
                               cols="6"
                               md="3">
                            <v-item v-slot="{ active, toggle }">
                                <v-card :v-model="model"
                                        :color="active ? '#E3F2FD' : ''"
                                        height="367"
                                        width="250"
                                        onclick="Mudarestado('minhaDiv')"
                                        :disabled="disabled == 1"
                                        @click="toggle">
                                    <v-scroll-y-transition>
                                        <div v-if="active"
                                             class="display-3 flex-grow-1 text-center">

                                        </div>
                                    </v-scroll-y-transition>


                                    <v-img :src="`${item.src}`"
                                           height="250"
                                           width="250"
                                           class="grey darken-4">

                                        <div v-if="active"
                                             class="blue display-3 flex-grow-1 text-center">
                                            <span style="font-size: 30px; margin: 21px 0; color:white;">Selecionado</span>
                                        </div>

                                    </v-img>

                                    <div class="text-center">
                                        <h5>{{`${item.nome}`}}</h5> <h3 style="color:red;">{{`${item.valor}`}}</h3>
                                    </div>


                                    <div class="text-center">
                                        <v-btn depressed
                                               color="#2196F3"
                                               dark>
                                            AGENDAR
                                            <v-icon dark
                                                    right>
                                                mdi-calendar
                                            </v-icon>

                                        </v-btn>
                                    </div>
                                </v-card>
                            </v-item>
                        </v-col>
                    </v-row>
                </v-container>
            </v-item-group>

            <br>
            <div style='display: block;' id="minhaDiv_addprod">
                <v-row align="center"
                       justify="space-around">
                    <v-btn depressed color="blue lighten-4" @click="add_prod()">
                        VER MAIS SERVIÇOS

                        <v-icon right
                                dark>
                            mdi-arrow-down-bold
                        </v-icon>
                    </v-btn>
                </v-row>
            </div>
            <br>
            <br>
            <br>
            <br>


            <div style='display: none;' id="minhaDiv" class="box">
                <br>
                <div class="text-center">
                    <v-dialog v-model="dialog"
                              persistent
                              width="550px">
                        <template v-slot:activator="{ on, attrs }">
                            <v-badge bordered
                                     v-model="carrinho"
                                     color="error"
                                     :content="qtd_carrinho"
                                     overlap>
                                <v-btn @click="abrir_dialog()"
                                       v-bind="attrs"
                                       v-on="on">
                                    FINALIZAR AGENDAMENTO
                                    <v-icon dark
                                            right>
                                        mdi-whatsapp
                                    </v-icon>
                                </v-btn>
                            </v-badge>
                        </template>


                        <v-card>
                            <v-system-bar color="blue lighten-5" height="40">
                                <v-spacer></v-spacer>
                                <v-btn icon
                                       color="red"
                                       x-large
                                       @click="fechar_dialog()">
                                    <v-icon right>mdi-close</v-icon>
                                </v-btn>
                            </v-system-bar>
                            <v-card-title color="pink darken-2" class="headline blue lighten-5">
                                Agendamento
                                <br>
                            </v-card-title>

                            <v-container>
                                <v-card outlined>
                                    <v-card-title><h6>Escolha a data e profissional do agendamento</h6></v-card-title>
                                    <v-container>
                                        <v-row dense>
                                            <v-col cols="12"
                                                   sm="5">
                                                <v-select v-model="funcionario"
                                                          :items="items_funcionarios"
                                                          :messages="exib_aviso"
                                                          :error="exib_erro"
                                                          item-text="nome_func"
                                                          item-value="id_func"
                                                          label="Profissional"
                                                          outlined></v-select>
                                            </v-col>
                                            <v-col cols="6" sm="4">

                                                <v-menu v-model="menudataini"
                                                        :close-on-content-click="false"
                                                        transition="scale-transition"
                                                        offset-y
                                                        max-width="290px"
                                                        min-width="auto">
                                                    <template v-slot:activator="{ on, attrs }">
                                                        <v-text-field v-model="data_agenda"
                                                                      label="Data"
                                                                      :error="exib_erro"
                                                                      :messages="exib_aviso"
                                                                      outlined
                                                                      readonly
                                                                      append-icon="mdi-calendar"
                                                                      v-bind="attrs"
                                                                      v-on="on"></v-text-field>
                                                    </template>
                                                    <v-date-picker v-model="dateini"
                                                                   no-title
                                                                   @change="carregar_horarios()"
                                                                   :allowed-dates="allowedDates"
                                                                   :min="new Date().toLocaleDateString().slice(6,10) + '-' + new Date().toLocaleDateString().slice(3,5) + '-' + new Date().toLocaleDateString().slice(0,2)"
                                                                   locale="pt-br"
                                                                   @input="menudataini = false"></v-date-picker>
                                                </v-menu>
                                            </v-col>
                                            <v-col cols="6"
                                                   sm="3">
                                                <v-select v-model="hora_agenda"
                                                          :items="horaselec"
                                                          :messages="exib_aviso"
                                                          :error="exib_erro"
                                                          label="Horário"
                                                          outlined></v-select>
                                            </v-col>
                                        </v-row>
                                    </v-container>
                                    <v-data-table :headers="headers"
                                                  :items="dados_produtos"
                                                  hide-default-footer
                                                  mobile-breakpoint="0"
                                                  :items-per-page="5000">

                                        <template v-slot:footer>
                                            <div>
                                                <h4 class="text-right">
                                                    <br>
                                                    {{ totalpedido }} &nbsp&nbsp&nbsp&nbsp

                                                </h4>
                                            </div>
                                        </template>
                                        <template v-slot:item.actions="{ item }">
                                            <v-icon color="red"
                                                    @click="deleteItem(item)">
                                                mdi-close
                                            </v-icon>
                                        </template>
                                        <template v-slot:no-data>
                                            <v-alert :value="true">
                                                O seu carrinho está vazio
                                            </v-alert>
                                        </template>
                                    </v-data-table>
                                </v-card>
                                <br>
                                <v-card outlined>
                                    <v-card-title><h6>Informe seus dados</h6></v-card-title>
                                    <v-container>
                                        <v-row dense>
                                            <v-col cols="7"
                                                   sm="7">
                                                <v-text-field outlined
                                                              :error="exib_erro"
                                                              :messages="exib_aviso"
                                                              v-model="nome_cli"
                                                              label="Nome"></v-text-field>
                                            </v-col>
                                            <v-col cols="5"
                                                   sm="5">
                                                <v-text-field :error="exib_erro" :messages="exib_aviso" v-model="cel_cli" v-mask="'(##)#####-####'" label="Celular" outlined></v-text-field>
                                            </v-col>
                                        </v-row>

                                        <v-row dense>
                                            <v-col cols="12"
                                                   sm="12">
                                                <v-text-field outlined
                                                              :error="exib_erro"
                                                              :messages="exib_aviso"
                                                              v-model="end_cli"
                                                              label="Endereço"></v-text-field>
                                            </v-col>
                                        </v-row>

                                        <v-row dense>
                                            <v-col cols="6"
                                                   sm="6">
                                                <v-text-field outlined
                                                              :error="exib_erro"
                                                              :messages="exib_aviso"
                                                              v-model="bairro_cli"
                                                              label="Bairro"></v-text-field>
                                            </v-col>
                                            <v-col cols="6"
                                                   sm="6">
                                                <v-text-field v-model="cidade"
                                                              :error="exib_erro"
                                                              :messages="exib_aviso"
                                                              label="Cidade"
                                                              outlined></v-text-field>
                                            </v-col>
                                        </v-row>
                                        <v-row>
                                            <v-col cols="12"
                                                   sm="12">
                                                <v-textarea v-model="observacao"
                                                            outlined
                                                            label="Observação para o profissional"></v-textarea>
                                            </v-col>
                                        </v-row>
                                    </v-container>
                                </v-card>

                            </v-container>
                            <v-divider></v-divider>

                            <v-card-actions>
                                <v-spacer></v-spacer>
                                <v-btn color="primary"
                                       @click="comprar()">
                                    <v-icon dark
                                            left>
                                        mdi-checkbox-marked-circle-outline
                                    </v-icon>
                                    FINALIZAR AGENDAMENTO
                                </v-btn>
                                <v-spacer></v-spacer>
                            </v-card-actions>
                        </v-card>
                    </v-dialog>
                </div>
            </div>

            <div class="text-center">
                <v-dialog v-model="dialog_carrinho_vazio"
                          width="500">
                    <v-card>
                        <v-card-title class="text-h5 grey lighten-2">
                            Serviços (0)
                        </v-card-title>

                        <v-card-text>
                            <br><br>
                            <v-row justify="center">
                                <v-col cols="12"
                                       sm="12">
                                    <h2>Nenhum serviço foi selecionado</h2>
                                </v-col>
                            </v-row>
                            <br><br>
                        </v-card-text>

                        <v-divider></v-divider>

                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="primary"
                                   text
                                   @click="dialog_carrinho_vazio = false">
                                OK
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>
            </div>

            <v-footer padless color="#EEEEEE">
                <!--  <v-col class="text-center"
             cols="12">
          <v-btn icon onclick="window.location.href ='https://www.facebook.com/riodoceatacado?'">
              <v-icon color="#616161">mdi-facebook</v-icon>
          </v-btn>
          <v-btn icon onclick="window.location.href ='https://www.instagram.com/riodoceatacado/'">
              <v-icon color="#616161">mdi-instagram</v-icon>
          </v-btn>
          <v-btn icon onclick="window.location.href ='https://api.whatsapp.com/send?phone=+5516991904728?'">
              <v-icon color="#616161">mdi-whatsapp</v-icon>
          </v-btn>
          <v-divider></v-divider>

      </v-col>-->

                <v-col class="text-center"
                       cols="12">
                    <span>Plataforma <a href="https://softenter.com.br/">Softenter</a>  © Todos os direitos reservados.</span>
                </v-col>
            </v-footer>

        </v-app>
    </div>



    <script>
        Vue.use(VueMask.VueMaskPlugin);

        function Mudarestado(el) {

            // Lança os produtos selecionados no carrinho
            app.__vue__.selec_prod()

            // Verifica se algum item foi desselecionado, se foi  exclui do carrinho e recalcula soma
            let item_exclu = app.__vue__.qtd_carrinho_aux.filter(a => !app.__vue__.model.includes(a));
            if (item_exclu.length > 0) {
                item = { preco: app.__vue__.items[item_exclu[0]].valor, produto: app.__vue__.items[item_exclu[0]].nome, qtd: '1', total: app.__vue__.items[item_exclu[0]].valor }
                editedIndex = app.__vue__.dados_produtos.findIndex(({ produto }) => produto === item.produto);
                app.__vue__.dados_produtos.splice(editedIndex, 1)
                app.__vue__.alterapreco()
            }

            // Atualiza informação de quantidade de item no carrinho
            app.__vue__.qtd_carrinho = app.__vue__.dados_produtos.length

            // Guarda quantidade de itens selecionados para comparar depois se algum item foi desselecionado
            app.__vue__.qtd_carrinho_aux = app.__vue__.model

            // Verifica se foi selecionado algum item para ocultar ou não o botão de finalizar compra
            if (app.__vue__.model.length == 0 && app.__vue__.dados_produtos.length == 0) {
                app.__vue__.carrinho = false
                var display = document.getElementById(el).style.display;
                document.getElementById(el).style.display = 'none';
            } else {
                app.__vue__.carrinho = true
                var display = document.getElementById(el).style.display;
                document.getElementById(el).style.display = 'block';
            }

            app.__vue__.abrir_dialog()

        }

        document.addEventListener('keydown', function (event) {
            if (event.keyCode !== 13) return;
            app.__vue__.pesq_prod()
        }),

            new Vue({
                el: '#app',
                vuetify: new Vuetify(),
                data: vm => ({
                    url: 'https://softenter.com.br',
                    //pagination: {},
                    headers: [
                        { text: '', value: 'actions', width: '50' },
                        { text: 'Serviço', value: 'produto' },
                        { text: 'Preço', value: 'total', width: '100' },
                    ],
                    exib_erro: false,
                    data_entrega: '',
                    end_cli: '',
                    bairro_cli: '',
                    cidade: '',
                    nome_cli: '',
                    cel_cli: '',
                    carregando: false,
                    soma: 0,
                    select: null,
                    dados_produtos: [],
                    cidades_item: ['Aramina', 'Guará', 'Igarapava', 'Ituverava', 'São Joaquim da barra', 'Outra cidade'],
                    qtdselec: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50'],
                    items_categoria: [],
                    value: 1,
                    active: true,
                    dialog: false,
                    items: [],
                    prod_descricao: '',
                    model: null,
                    toggle: null,
                    active: null,
                    disabled: 0,
                    fim: 40,
                    ini: 20,
                    totalpedido: '',
                    model_categoria: null,
                    qtd_carrinho: 0,
                    carrinho: false,
                    dialog_carrinho_vazio: false,
                    qtd_carrinho_aux: [],
                    items_funcionarios: [],
                    data_agenda: new Date().toLocaleDateString(),
                    menudataini: false,
                    dateini: new Date().toLocaleDateString().substr(6, 4) + '-' + new Date().toLocaleDateString().substr(3, 2) + '-' + new Date().toLocaleDateString().substr(0, 2),
                    horaselec: [],
                    funcionario: '',
                    hora_agenda: '',
                    observacao: '',
                    drawer: null,
                    datas_cheias: [],
                    semana: ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"],
                    exib_aviso: '', 
                    titulo_categoria: '',
                    src_logo: '',
                    nome_empresa: '',
                }),

                watch: {
                    dateini(val) {
                        this.data_agenda = this.formatDate(this.dateini)
                    },
                },

                created() {
                    this.initialize()

                },
                methods: {

                    async carregar_horarios() {
                        listar_horarios = await axios.get(this.url + '/api/agenda_horarios/listar/agenda_horarios?Fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        dia_semana_extenso = this.semana[new Date(this.dateini.slice(5, 7) + '/' + this.dateini.slice(8, 10) + '/' + this.dateini.slice(0, 4)).getDay()]
                        horarios = listar_horarios.data.filter(function (obj) { return obj.dia_semana == dia_semana_extenso });

                        dia_selecionado = this.dateini.slice(8, 10) + '/' + this.dateini.slice(5, 7) + '/' + this.dateini.slice(0, 4)

                        agendados_dia = await axios.get(this.url + '/api/pedidos/pedidos/pesquisar?data_ini=' + dia_selecionado + '&data_fim=' + dia_selecionado + '&Fk_empresa=' + listar_empresa_nome_link.data[0].id + '&usuario=&cliente_pesq=&nome_prod=')

                        if (agendados_dia.data.length > 0) {
                            for (var i = 0; i < agendados_dia.data.length; i++) {
                                if (horarios.findIndex(hr => hr.horario === agendados_dia.data[i].data.slice(11, 19)) != -1) {
                                    horarios.splice(horarios.findIndex(hr => hr.horario === agendados_dia.data[i].data.slice(11, 19)), 1)
                                }

                            }
                        }

                        this.horaselec = []
                        for (var i = 0; i < horarios.length; i++) {
                            this.horaselec.push(horarios[i].horario.slice(0, 5))
                        }


                    },

                    async dias_ocupados() {

                        var data_fim_dias_agendados = new Date();
                        data_fim_dias_agendados.setDate(data_fim_dias_agendados.getDate() + 360);

                        listar_dias_funcionamento = await axios.get(this.url + '/api/agenda_horarios/listar/qtd_h?Fk_empresa=' + listar_empresa_nome_link.data[0].id)

                        listar_dias_agendados = await axios.get(this.url + '/api/pedidos/pedidos/agendados?data_ini=' + new Date().toLocaleDateString() + '&data_fim=' + data_fim_dias_agendados.toLocaleDateString() + '&Fk_empresa=' + listar_empresa_nome_link.data[0].id)



                        for (i = 0; i < listar_dias_agendados.data.length; i++) {
                            let dia_semana = new Date(listar_dias_agendados.data[i].data.slice(3, 5) + '/' + listar_dias_agendados.data[i].data.slice(0, 2) + '/' + listar_dias_agendados.data[i].data.slice(6, 10)).getDay()

                            if (dia_semana == 0) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Domingo').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 1) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Segunda').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 2) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Terça').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 3) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Quarta').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 4) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Quinta').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 5) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Sexta').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }
                            if (dia_semana == 6) {
                                if (listar_dias_agendados.data[i].n_agendados == listar_dias_funcionamento.data.find(dia => dia.dia_semana === 'Sábado').qtd_h) {
                                    this.datas_cheias.push(listar_dias_agendados.data[i].data)
                                }

                            }

                        }



                    },

                    allowedDates(val) {



                        if (typeof this.datas_cheias.find(element => element == val.slice(8, 10) + '/' + val.slice(5, 7) + '/' + val.slice(0, 4)) != "undefined") {
                            return false
                        } else if (typeof listar_dias_funcionamento.data.find(prod => prod.dia_semana === this.semana[new Date(val.slice(5, 7) + '/' + val.slice(8, 10) + '/' + val.slice(0, 4)).getDay()]) === "undefined") {
                            return false
                        } else {
                            return true
                        }

                    },


                    formatDate(date) {
                        if (!date) return null

                        const [year, month, day] = date.split('-')
                        return `${day}/${month}/${year}`
                    },

                    deleteItem(item) {
                        this.editedIndex = this.dados_produtos.indexOf(item)
                        this.dados_produtos.splice(this.editedIndex, 1)
                        this.model.splice(this.editedIndex, 1)
                        this.alterapreco()
                        this.qtd_carrinho = this.dados_produtos.length

                        if (this.qtd_carrinho == 0) {
                            Mudarestado('minhaDiv')
                        }
                    },

                    selec_prod() {
                        // if (this.dados_produtos.length < 1) {
                        for (i = 0; i < this.model.length; i++) {
                            var item_selecionado = this.model[i];
                            if (typeof this.dados_produtos.find(item => item.produto === listar_estoques.data[item_selecionado].produto) == "undefined") {
                                this.dados_produtos.push(
                                    {
                                        id: listar_estoques.data[item_selecionado].id,
                                        custo: listar_estoques.data[item_selecionado].custo.slice(3, listar_estoques.data[item_selecionado].custo.length),
                                        produto: this.items[item_selecionado].nome,
                                        qtd: '1',//this.dados_produtos
                                        data_agenda: new Date().toLocaleDateString(),
                                        preco: this.items[item_selecionado].valor,
                                        total: this.items[item_selecionado].valor,
                                    })
                            }
                        }
                        // }
                    },

                    entrega() {
                        if (this.cidade == 'Aramina') {
                            this.data_entrega = 'Dia de entrega nesta cidade: Quarta-feira'
                        } else if (this.cidade == 'Guará') {
                            this.data_entrega = 'Dia de entrega nesta cidade: Terça-feira'
                        } else if (this.cidade == 'Igarapava') {
                            this.data_entrega = 'Dia de entrega nesta cidade: Quarta-feira'
                        } else if (this.cidade == 'Ituverava') {
                            this.data_entrega = 'Dias de entrega nesta cidade: Segunda, Quinta e Sexta à tarde'
                        } else if (this.cidade == 'São Joaquim da barra') {
                            this.data_entrega = 'Dia de entrega nesta cidade: Terça-feira'
                        } else if (this.cidade == 'Outra cidade') {
                            this.data_entrega = 'Informe a sua cidade após finalizar a compra'
                        }
                    },

                    alterapreco() {
                        soma = 0
                        for (i = 0; i < this.dados_produtos.length; i++) {

                            // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                            if (parseInt(this.dados_produtos[i].preco.toString().replaceAll(",", "").replaceAll(".", "").slice(2, this.dados_produtos[i].length).length) > 5) {
                                preco_prod = this.dados_produtos[i].preco.toString().replace(".", "");
                            } else {
                                preco_prod = this.dados_produtos[i].preco
                            }

                            this.dados_produtos[i].total = (this.dados_produtos[i].qtd * preco_prod.substr(2, this.dados_produtos[i].preco.length).replace(",", ".")).toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })

                            // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                            if (parseInt(this.dados_produtos[i].total.toString().replaceAll(",", "").replaceAll(".", "").slice(2, this.dados_produtos[i].length).length) > 5) {
                                sub_total = this.dados_produtos[i].total.toString().replace(".", "");
                            } else {
                                sub_total = this.dados_produtos[i].total
                            }

                            soma = soma + parseFloat(sub_total.substr(2, sub_total.length).replace(",", "."))

                        }
                        //this.dados_produtos[i].preco
                        this.totalpedido = 'TOTAL: ' + soma.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })

                    },

                    select_categoria() {
                        if (this.model != null) {
                            this.selec_prod()
                        }
                        this.qtd_carrinho_aux = []
                        this.model = []
                        this.initialize()
                    },

                    async pesq_prod() {
                        if (this.model != null) {
                            this.selec_prod()
                        }
                        this.model = []
                        listar_estoques = await axios.get(this.url + '/api/produtos/listar/produtos_nome?Nome=' + this.prod_descricao + '&Check_estoque_minimo=2' + '&fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        if (listar_estoques.data.length > 0) {
                            if (listar_estoques.data.length <= 20) {
                                document.getElementById('minhaDiv_addprod').style.display = 'none';
                                fim = listar_estoques.data.length
                            } else {
                                document.getElementById('minhaDiv_addprod').style.display = 'block';
                                fim = 20
                            }
                            this.items = []
                            var i;
                            for (i = 0; i < fim; i++) {

                                this.items.push(
                                    {
                                        nome: listar_estoques.data[i].produto,
                                        valor: listar_estoques.data[i].valor_pessoa_fisica,
                                        valor_numero: listar_estoques.data[i].valor_pessoa_fisica.substr(2),
                                        src: listar_estoques.data[i].imagem_link,
                                    }
                                )

                                if (this.dados_produtos.findIndex(({ id }) => id === listar_estoques.data[i].id) != -1) {
                                    this.model.push(i)
                                }
                            }
                        } else {
                            this.items = []
                        }
                        if (this.model != null) {
                            this.qtd_carrinho_aux = this.model
                        }

                        if (this.prod_descricao != '') {
                            this.titulo_categoria = 'Resultados para “' + this.prod_descricao + '”'
                        } else {
                            this.titulo_categoria = 'Todos os serviços'
                        }

                        this.drawer = false

                    },

                    abrir_dialog() {

                        this.carregar_horarios()

                        if (this.qtd_carrinho == 0) {
                            this.dialog_carrinho_vazio = true
                        } else {
                            this.dialog = true
                            this.selec_prod()
                            this.limit_prod()
                            var i;
                            for (i = 0; i < this.dados_produtos.length; i++) {


                                // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                                if (parseInt(this.dados_produtos[i].total.toString().replaceAll(",", "").replaceAll(".", "").slice(2, this.dados_produtos[i].length).length) > 5) {
                                    sub_total = this.dados_produtos[i].total.toString().replace(".", "");
                                } else {
                                    sub_total = this.dados_produtos[i].total
                                }

                                this.soma = this.soma + parseFloat(sub_total.substring(2, this.dados_produtos[i].total.length).replace(",", "."))
                            }

                            this.totalpedido = 'TOTAL: ' + this.soma.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })
                            this.soma = 0
                        }
                    },

                    async comprar() {

                        if (this.nome_cli == "" || this.cel_cli == "" || this.end_cli == "" || this.bairro_cli == "" || this.cidade == "" || this.funcionario == "" || this.hora_agenda == "") {
                            this.exib_erro = true
                            this.exib_aviso = 'Preenchimento obrigatório'
                            alert("Erro: Preencha todos os campos !");
                        } else {
                            item_selec = this.model
                            produto = ""
                            soma = 0

                            data_agenda = this.data_agenda
                            dia = data_agenda.slice(0, 2);
                            mes = data_agenda.slice(3, 5);
                            ano = data_agenda.slice(6, 10);
                            //let hora_atual = ("0" + new Date().getHours()).slice(-2) + ':' + new Date().getMinutes()

                            data_agenda = ano + "-" + mes + "-" + dia + " " + this.hora_agenda
                            observacao = this.observacao.replaceAll("\n", "\\n")
                            // Salva pedidos na agenda
                            salvar_resq = await axios.post(this.url + '/api/pedidos/pedidos/salvar?desc_ataca=0&prec_custo=0&bairro=' + this.bairro_cli + '&data=' + data_agenda + '&concluir=0' + '&endereco=' + this.end_cli + '&cidade=' + this.cidade + '&celular=' + this.cel_cli + '&descricao=' + observacao + '&cliente=' + this.nome_cli + '&fk_cod_cli=null&Fk_empresa=' + listar_empresa_nome_link.data[0].id + '&fk_funcionario=' + this.funcionario + '&concluido_por=null&prazo=0&parcelas=null&data_vencimento=null&forma_pagamento=Dinheiro')

                            listar_maior_id_pedido = await axios.get(this.url + '/api/pedidos/pedidos/maior_id?Fk_empresa=' + listar_empresa_nome_link.data[0].id)

                            var i;
                            for (i = 0; i < this.dados_produtos.length; i++) {

                                produto = produto + this.dados_produtos[i].qtd + " " + this.dados_produtos[i].produto + " " + this.dados_produtos[i].preco + "%0A"

                                // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                                if (parseInt(this.dados_produtos[i].preco.toString().replaceAll(",", "").replaceAll(".", "").slice(2, this.dados_produtos[i].length).length) > 5) {
                                    this.dados_produtos[i].preco = this.dados_produtos[i].preco.toString().replace(".", "");
                                }

                                // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                                if (parseFloat(this.dados_produtos[i].custo.toString().replaceAll(",", "").replaceAll(".", "").length) > 5) {
                                    this.dados_produtos[i].custo = this.dados_produtos[i].custo.toString().replace(".", "");
                                }

                                precototal_prod = this.dados_produtos[i].total.slice(2, this.dados_produtos[i].total.toString().length);

                                // VERIFICA SE O VALOR DO PRODUTO É MAIOR QUE 1000 PARA FORMATAR O VALOR CORRETAMENTE
                                if (parseInt(precototal_prod.toString().replaceAll(",", "").replaceAll(".", "").length) > 5) {
                                    precototal_prod = precototal_prod.toString().replace(".", "");
                                }

                                custo_prod = this.dados_produtos[i].custo.toString().replace(",", ".");
                                preco_prod = this.dados_produtos[i].preco.toString().replace(",", ".").slice(2, this.dados_produtos[i].preco.toString().length);
                                precototal_prod = precototal_prod.replace(",", ".")

                                soma = soma + parseFloat(precototal_prod.toString().replace(",", "."));

                                id_pedido = listar_maior_id_pedido.data[0].id

                                salvar_resq = await axios.post(this.url + '/api/produtos_pedidos/produtos_pedidos/salvar?nome=' + this.dados_produtos[i].produto + '&qtd=' + this.dados_produtos[i].qtd + '&valor_unitario=' + preco_prod + '&valor_total=' + precototal_prod + '&fk_pedido=' + id_pedido + '&cod_prod=' + this.dados_produtos[i].id + '&Fk_empresa=' + listar_empresa_nome_link.data[0].id + '&custo=' + custo_prod)
                            }
                            produto = produto + "%0A" + "TOTAL: " + soma.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });

                            dados_entrega = 'PROFISSIONAL: ' + this.items_funcionarios[0].nome_func + "%0A" + 'DATA: ' + this.data_agenda + "%0A" + 'HORÁRIO: ' + this.hora_agenda + "%0A%0A" + 'Nome: ' + this.nome_cli + "%0A" + 'Celular: ' + this.cel_cli + "%0A" + 'Endereço: ' + this.end_cli + "%0A" + 'Bairro: ' + this.bairro_cli + "%0A" + 'Cidade: ' + this.cidade + "%0A" + "%0A"

                            window.open('https://api.whatsapp.com/send?phone=+55' + listar_empresa_nome_link.data[0].telefone.replace(/[^0-9]/g, '') + '&text=' + dados_entrega + produto);

                            this.dialog = false

                            window.location.reload(true);
                        }

                    },

                    async add_prod() {
                        this.carregando = true

                        // if (this.prod_descricao == '') {
                        if (this.model_categoria != null) {
                            listar_estoques = await axios.get(this.url + '/api/produtos/listar/produtos_catalogo_categoria?primeiro_acesso=false&Fk_empresa=' + listar_empresa_nome_link.data[0].id + '&categoria=' + item_selecionado)
                        } else {
                            listar_estoques = await axios.get(this.url + '/api/produtos/listar/produtos_catalogo?primeiro_acesso=false&Fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        }
                        //  }

                        var i;
                        for (i = 20; i < listar_estoques.data.length; i++) {

                            if (this.items.length != listar_estoques.data.length) {
                                this.items.push(
                                    {
                                        nome: listar_estoques.data[i].produto,
                                        valor: listar_estoques.data[i].valor_pessoa_fisica,
                                        valor_numero: listar_estoques.data[i].valor_pessoa_fisica.substr(2),
                                        src: listar_estoques.data[i].imagem_link,
                                    }
                                )
                                if (this.dados_produtos.findIndex(({ id }) => id === listar_estoques.data[i].id) != -1) {
                                    this.model.push(i)
                                }
                            }
                        }
                        document.getElementById('minhaDiv_addprod').style.display = 'none';
                        this.carregando = false
                    },

                    limit_prod() {
                        this.items = this.items.slice(0, 20)
                        document.getElementById('minhaDiv_addprod').style.display = 'block';
                    },

                    fechar_dialog() {
                        this.dialog = false
                    },

                    async initialize() {

                        this.carregando = true

                        listar_empresa_nome_link = await axios.get(this.url + '/api/empresa_config/listar/empresa_nome_link?nome_link=' + window.location.href.slice(25, window.location.href.length - 5))

                        this.src_logo = listar_empresa_nome_link.data[0].logo
                        this.nome_empresa = listar_empresa_nome_link.data[0].nome

                        this.dias_ocupados()

                        this.items_funcionarios = []
                        listar_func = await axios.get(this.url + '/api/funcionarios/listar/funcionarios?fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        for (var i = 0; i < listar_func.data.length; i++) {
                            this.items_funcionarios.push(
                                {
                                    id_func: listar_func.data[i].id,
                                    nome_func: listar_func.data[i].nome,
                                })
                        }

                        listar_categoria = await axios.get(this.url + '/api/categorias/listar/categorias?Fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        this.items_categoria = []
                        for (var i = 0; i < listar_categoria.data.length; i++) {
                            this.items_categoria.push(
                                {
                                    id_categoria: listar_categoria.data[i].id,
                                    nome_categoria: listar_categoria.data[i].nome,
                                    imagem: listar_categoria.data[i].imagem,
                                })
                        }

                        this.items = []

                        if (this.model_categoria != null) {
                            this.titulo_categoria = this.items_categoria[this.model_categoria].nome_categoria
                            this.titulo_categoria = this.titulo_categoria.substring(0, 1).toUpperCase() + this.titulo_categoria.substring(1, this.titulo_categoria.length).toLowerCase()
                        } else {
                            this.titulo_categoria = 'Todos os serviços'
                        }

                        if (this.model_categoria != null) {
                            item_selecionado = this.items_categoria[this.model_categoria].id_categoria
                            listar_estoques = await axios.get(this.url + '/api/produtos/listar/produtos_catalogo_categoria?primeiro_acesso=true&Fk_empresa=' + listar_empresa_nome_link.data[0].id + '&categoria=' + item_selecionado)
                        } else {
                            listar_estoques = await axios.get(this.url + '/api/produtos/listar/produtos_catalogo?primeiro_acesso=true&Fk_empresa=' + listar_empresa_nome_link.data[0].id)
                        }

                        if (listar_estoques.data.length <= 20) {
                            document.getElementById('minhaDiv_addprod').style.display = 'none';
                            fim = listar_estoques.data.length
                        } else {
                            document.getElementById('minhaDiv_addprod').style.display = 'block';
                            fim = 20
                        }

                        var i;
                        for (i = 0; i < fim; i++) { ///listar_estoques.data.length

                            this.items.push(
                                {
                                    nome: listar_estoques.data[i].produto,
                                    valor: listar_estoques.data[i].valor_pessoa_fisica,
                                    valor_numero: listar_estoques.data[i].valor_pessoa_fisica.substr(2),
                                    src: listar_estoques.data[i].imagem_link,
                                }
                            )

                            if (this.dados_produtos.findIndex(({ id }) => id === listar_estoques.data[i].id) != -1) {
                                this.model.push(i)
                            }
                        }

                        this.carregando = false

                        if (this.model != null) {
                            this.qtd_carrinho_aux = this.model
                        }
                    }
                },

            })


    </script>

</body>

</html>
